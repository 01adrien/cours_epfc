set search_path to bdge;
drop schema if exists bdlivre cascade;
create schema bdlivre;
set search_path to bdge, bdlivre;

create domain tannee as int null;
create domain tgenre as varchar(15) null;
create domain tisbn as varchar(15) null;
create domain tlangue char(2) null;
create domain tnom varchar(20) null;
create domain tprenom varchar(15) null;
create domain tsexe char(1) null;
create domain ttitre varchar(50) null;

create table oeuvre
(
    idoeuvre int primary key generated by default as identity,
    titre    ttitre  null,
    annee    tannee  null,
    genre    tgenre  null,
    langue   tlangue null
);

insert into oeuvre (idoeuvre, titre, annee, genre, langue)
values (1, 'Program Develpment in Java', 2001, 'Informatique', 'En'),
       (2, 'Hamlet', 1603, 'Tragédie', 'En'),
       (3, 'Mais qui a tordu la trompette de Dizzy', 2009, 'Musique', 'Fr'),
       (4, 'Young Man with a Horn', 1938, 'Roman', 'En'),
       (5, 'L''Ecume des jours', 1947, 'Roman', 'Fr'),
       (6, 'Artificial Intelligence', 1995, 'Informatique', 'En'),
       (7, 'OEUVRE SANS LIVRE', 800, 'Mystère', 'Es');

alter sequence oeuvre_idoeuvre_seq restart with 8;

create table livre_paru
(
    idlivre       int primary key generated by default as identity,
    isbn          tisbn   null,
    titre         ttitre  null,
    editeur       tnom    null,
    langue        tlangue null,
    pays          tnom    null,
    date_parution date    null,
    nb_pages      int     null,
    numoeuvre     int     null,
    constraint fk_livre foreign key (numoeuvre)
        references oeuvre (idoeuvre)
        on delete cascade
);

insert into livre_paru
(idlivre, isbn, titre, editeur, langue, pays, date_parution, nb_pages, numoeuvre)
values (1, '0201657686', 'Program Development in Java', 'Addison-Wesley', 'En', 'US', '2002-10-01', 443, 1),
       (2, '9782070197514', 'Hamlet', 'Gallimard', 'Fr', 'Fr', '2016-10-03', 208, 2),
       (6, '9780486272788', 'Hamlet', 'Dover Publications', 'En', 'Uk', '1992-09-24', 128, 2),
       (7, '9781853260094', 'Hamlet', 'Wordsworth Editions', 'En', 'Uk', '1997-08-01', 192, 2),
       (8, '9782360150007', 'Mais qui a tordu la trompette de Dizzy ?', 'Nova editions', 'Fr', 'Fr', '2009-11-04',
        143, 3),
       (9, '9782072436567', 'Le Jeune homme à la trompette', 'Gallimard', 'Fr', 'Fr', '1951-02-21', 296, 4),
       (10, '9782720215346', 'L''écume des jours', 'Pauvert', 'Fr', 'Fr', '2013-03-27', 234, 5),
       (11, '9782071022860', 'L''écume des jours', 'Gallimard', 'Fr', 'Fr', '1947-01-01', 218, 5),
       (12, '9780136042594', 'Intelligence artificielle 2d ed', 'Pearson', 'Fr', 'Fr', '2006-09-13', 1184, 6),
       (13, '9782744074554', 'Intelligence artificielle 3d ed', 'Pearson', 'Fr', 'Fr', '2010-12-10', 1198, 6),
       (14, '1111111111111', 'Hamlet', 'Edit_italien', 'It', 'It', '1980-06-05', 200, 2),
       (15, '2222222222222', 'Hamlet (pour les Nuls)', 'Seuil', 'Fr', 'Fr', '2019-01-01', 200, 2),
       (16, '3333333333333', 'L''écume des jours', null, 'Fr', 'Fr', '2019-01-01', 200, 5),
       (17, '4444444444444', 'L''écume des jours', null, 'It', 'It', '2019-01-01', 200, 5);

alter sequence livre_paru_idlivre_seq restart with 18;

create table traducteur_ecrivain
(
    idtrad_ecriv int primary key generated by default as identity,
    -- idtrad_ecriv int default nextval(traducteur_ecrivain_idtrad_ecriv_seq) not null,
    nom          tnom    null,
    prenom       tprenom null,
    ddn          date    null,
    ddd          date    null,
    nat          tlangue null,
    sexe         tsexe   null
);

insert into traducteur_ecrivain
    (idtrad_ecriv, nom, prenom, ddn, ddd, nat, sexe)
values (1, 'LISKOV', 'Barbara', '1939-11-07', null, 'Us', 'F'),
       (2, 'GUTTAG', 'John', '1949-03-06', null, 'Us', 'M'),
       (3, 'Shakespeare', 'William', '1564-04-26', '1616-04-23', 'En', 'M'),
       (4, 'Déprat', 'Jean-Michel', '1949-02-19', null, 'Fr', 'M'),
       (5, 'Costemalle', 'Bruno', null, null, 'Fr', 'M'),
       (6, 'Baker', 'Dorothy', '1907-04-21', '1968-06-17', 'Us', 'F'),
       (7, 'Vian', 'Boris', '1920-03-10', '1959-06-23', 'Fr', 'M'),
       (8, 'Russel', 'Stuart', null, null, 'En', 'M'),
       (9, 'Norvig', 'Peter', '1956-05-12', null, 'Us', 'M'),
       (10, 'Miclet', 'Laurent', null, null, 'Fr', 'M'),
       (11, 'Popineau', 'Fabrice', null, null, 'Fr', 'M'),
       (12, 'Baland', 'Marie-Cecile', null, null, 'Fr', 'F'),
       (13, 'TRAD', 'Une', '1950-05-10', '2018-10-21', 'Be', 'F'),
       (14, 'TRAD', 'Duo', '1980-07-03', null, 'It', 'F');

alter sequence traducteur_ecrivain_idtrad_ecriv_seq restart with 15;

create table ecrit_par
(
    numoeuvre int not null,
    numecriv  int not null,
    constraint pk_ecrit_par primary key (numoeuvre, numecriv),
    constraint fk_ecriv1 foreign key (numoeuvre)
        references oeuvre (idoeuvre)
        on delete cascade,
    constraint fk_ecriv2 foreign key (numecriv)
        references traducteur_ecrivain (idtrad_ecriv)
        on delete cascade
);

insert into ecrit_par (numoeuvre, numecriv)
values (1, 1),
       (1, 2),
       (2, 3),
       (3, 5),
       (4, 6),
       (5, 7),
       (6, 8),
       (6, 9);

create table traduit_par
(
    numlivre int not null,
    numtrad  int not null,
    constraint pk_traduit_par primary key (numlivre, numtrad),
    constraint fk_trad1 foreign key (numlivre)
        references livre_paru (idlivre)
        on delete cascade,
    constraint fk_trad2 foreign key (numtrad)
        references traducteur_ecrivain (idtrad_ecriv)
        on delete cascade
);

insert into traduit_par (numlivre, numtrad)
values (2, 4),
       (2, 13),
       (9, 7),
       (12, 11),
       (12, 12),
       (13, 10),
       (13, 11),
       (13, 12),
       (14, 14),
       (15, 4);
